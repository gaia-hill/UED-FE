### TCP三次握手

http和https都是基于tcp协议进行数据传输的，tcp协议为传输层协议，http与https为应用层协议，下面为建立一个tcp链接需要进行的过程

#### http

http协议是互联网应用最为广泛的，它传输数据的方式为明文传输，所以传输时是不安全的，其建立tcp链接时如下图：



![](https://ww2.sinaimg.cn/large/006tKfTcly1fdt9hqbxuej30jc0gaq3f.jpg)

1. 客户端发送握手信号syn j到服务端，等待服务器确认（第一次握手）；

2. 服务端收到信号后返回确认码ack j+1以及自己的握手信号syn k（第二次握手）；

3. 客户端收到服务器返回的的syn k后，发送确认码ack k+1到服务器（第三次握手），完成三次握手后开始传输数据；

####https

https协议是在http协议的基础上添加了ssl协议加密，

![](https://ww1.sinaimg.cn/large/006tNc79ly1fdt9if5prpj30i00fkwg8.jpg)

1. 客服端发送自己的一套加密规则给服务端；

2. 服务端从中选择一种规则后，将自己的数字证书(ca证书或者自制证书)发给浏览器；

3. 客服端接收到证书之后需要:

   a) 验证证书的合法性.

   b)如果证书受信（或用户选择信任不受信证书），浏览器生成一串随机值，并用证书中提供的公钥加密.

   c)将加密后的值发送给服务端.

4. 服务端接收到返回的值后需要:

   a)使用自己的私钥将信息解密取出该随机值.

   b)使用该值加密消息，发送给浏览器.

5. 浏览器根据随机值解密消息，之后通信数据将由之前浏览器生成的随机密码进行加密.


